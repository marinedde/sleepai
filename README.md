# üß† SleepAI - Pipeline MLOps pour l'Analyse de Polysomnographie

> Pipeline MLOps complet pour la classification automatique des stades de sommeil √† partir de signaux EEG polysomnographiques.

**Technologies :** Python 3.10 | FastAPI | Docker | Scikit-learn | Streamlit | GitHub Actions

**üåê API D√©ploy√©e :** [https://sleepai-api.onrender.com](https://sleepai-api.onrender.com/docs)

---

## üìã Table des mati√®res

- [√Ä propos](#-√†-propos)
- [D√©mo en ligne](#-d√©mo-en-ligne)
- [Architecture](#-architecture)
- [Fonctionnalit√©s](#-fonctionnalit√©s)
- [Installation](#-installation)
- [Utilisation](#-utilisation)
- [API Endpoints](#-api-endpoints)
- [Dashboard](#-dashboard)
- [Mod√®les](#-mod√®les)
- [Technologies](#-technologies)
- [Performances](#-performances)
- [Perspectives](#-perspectives)

---

## üéØ √Ä propos

Ce projet impl√©mente un pipeline MLOps de bout en bout pour la classification automatique des stades de sommeil (Wake, N1, N2, N3, REM) √† partir de signaux EEG. Il s'inscrit dans le cadre du programme de formation Jedha Bootcamp et d√©montre la ma√Ætrise des pratiques MLOps modernes.

**Contexte m√©dical :** La polysomnographie prend en moyenne **4h d'analyse manuelle** par patient. Les logiciels actuels co√ªtent entre 10 000 et 20 000‚Ç¨ et n'int√®grent pas de Machine Learning moderne. Ce projet propose une approche automatis√©e et accessible.

---

## üöÄ D√©mo en ligne

**API REST d√©ploy√©e :** [https://sleepai-api.onrender.com](https://sleepai-api.onrender.com/docs)

**Endpoints disponibles :**
- üè• Health check : `GET /health`
- üìä Informations mod√®le : `GET /model-info`
- üîÆ Pr√©diction : `POST /predict`

**Exemple de requ√™te :**
```bash
# Test de sant√©
curl https://sleepai-api.onrender.com/health

# Informations du mod√®le
curl https://sleepai-api.onrender.com/model-info
```

> **Note :** L'instance gratuite Render se met en veille apr√®s 15 minutes d'inactivit√©. La premi√®re requ√™te peut prendre 30 secondes pour r√©veiller le service.

---

## üèóÔ∏è Architecture

```
sleepai/
‚îú‚îÄ‚îÄ app/                          # Application FastAPI
‚îÇ   ‚îú‚îÄ‚îÄ main.py                  # API endpoints
‚îÇ   ‚îú‚îÄ‚îÄ ml_model.py              # Gestion du mod√®le ML
‚îÇ   ‚îú‚îÄ‚îÄ feature_extractor.py    # Extraction de features
‚îÇ   ‚îî‚îÄ‚îÄ models.py                # Sch√©mas Pydantic
‚îÇ
‚îú‚îÄ‚îÄ dashboard/                    # Interface Streamlit
‚îÇ   ‚îú‚îÄ‚îÄ streamlit_app.py         # Application dashboard
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt         # D√©pendances Streamlit
‚îÇ
‚îú‚îÄ‚îÄ models/                       # Mod√®les ML s√©rialis√©s
‚îÇ   ‚îú‚îÄ‚îÄ rf_v2_pipeline.joblib    # Pipeline Random Forest (production)
‚îÇ   ‚îú‚îÄ‚îÄ rf_v3_best_params.pkl    # Hyperparam√®tres optimis√©s
‚îÇ   ‚îî‚îÄ‚îÄ rf_v3_feature_names.pkl  # Noms des features
‚îÇ
‚îú‚îÄ‚îÄ notebooks/                    # Notebooks d'exploration
‚îÇ   ‚îú‚îÄ‚îÄ preprocessing.ipynb      # Pr√©traitement des donn√©es
‚îÇ   ‚îú‚îÄ‚îÄ model_training.ipynb     # Entra√Ænement des mod√®les
‚îÇ   ‚îî‚îÄ‚îÄ cnn_model.ipynb          # Exp√©rimentations CNN
‚îÇ
‚îú‚îÄ‚îÄ data/                         # Donn√©es (non versionn√©es)
‚îÇ   ‚îú‚îÄ‚îÄ raw/                     # Donn√©es brutes
‚îÇ   ‚îî‚îÄ‚îÄ processed/               # Donn√©es pr√©trait√©es
‚îÇ
‚îú‚îÄ‚îÄ Dockerfile                    # Configuration Docker
‚îú‚îÄ‚îÄ docker-compose.yml           # Orchestration Docker
‚îú‚îÄ‚îÄ render.yaml                   # Configuration Render
‚îî‚îÄ‚îÄ requirements.txt             # D√©pendances Python
```

**Architecture applicative :**
```
[Dashboard Streamlit] --HTTP--> [API FastAPI sur Render] --> [Mod√®le Random Forest]
```

---

## ‚ú® Fonctionnalit√©s

### Phase 1 : Pipeline ML ‚úÖ
- Pr√©traitement des signaux EEG
- Extraction de 16 features (temporelles + fr√©quentielles)
- Entra√Ænement Random Forest avec validation crois√©e
- Optimisation des hyperparam√®tres
- S√©rialisation du pipeline complet

### Phase 2 : API REST ‚úÖ
- API FastAPI avec documentation automatique (Swagger)
- Endpoint de sant√© (`/health`)
- Endpoint d'information mod√®le (`/model-info`)
- Endpoint de pr√©diction (`/predict`)
- Chargement automatique du mod√®le au d√©marrage
- Validation des donn√©es avec Pydantic

### Phase 3 : Dockerization ‚úÖ
- Container Docker optimis√© (Python 3.10-slim)
- Orchestration avec docker-compose
- Volumes pour mod√®les et donn√©es
- D√©ploiement sur Render

### Phase 4 : Dashboard Streamlit ‚úÖ
- Interface graphique interactive
- Visualisation des signaux EEG
- Pr√©diction en temps r√©el
- Affichage des probabilit√©s par stade

### Phase 5 : CI/CD (En cours)
- Tests automatis√©s avec GitHub Actions
- Build et push d'images Docker
- D√©ploiement automatique

---

## üöÄ Installation

### Pr√©requis

- Python 3.10+
- Docker et Docker Compose
- Git

### Installation locale

```bash
# Cloner le repository
git clone https://github.com/marinedde/sleepai.git
cd sleepai

# Cr√©er un environnement virtuel
python -m venv venv
source venv/bin/activate  # Sur Windows: venv\Scripts\activate

# Installer les d√©pendances
pip install -r requirements.txt
```

---

## üê≥ Utilisation avec Docker (Recommand√©)

### Lancer l'API

```bash
# Build et lancement
docker-compose up -d

# Voir les logs
docker-compose logs -f

# Arr√™ter
docker-compose down
```

L'API sera accessible sur `http://localhost:8000`

### Documentation interactive

Une fois l'API lanc√©e, acc√©dez √† la documentation Swagger :

```
http://localhost:8000/docs
```

---

## üì° API Endpoints

### Health Check

```bash
GET /health
```

**R√©ponse :**
```json
{
  "status": "healthy",
  "model_loaded": true,
  "model_path": "/app/notebooks/models/rf_v2_pipeline_fixed.joblib"
}
```

### Informations du Mod√®le

```bash
GET /model-info
```

**R√©ponse :**
```json
{
  "model_type": "Random Forest with Feature Engineering",
  "accuracy": 0.6462,
  "f1_score": 0.6377,
  "cohens_kappa": 0.5247,
  "classes": ["Wake", "N1", "N2", "N3", "REM"],
  "n_features": 16,
  "training_date": "2025-10-16"
}
```

### Pr√©diction

```bash
POST /predict
Content-Type: application/json

{
  "signal": [0.1, 0.2, 0.3, ..., 0.5],
  "sampling_rate": 100
}
```

**R√©ponse :**
```json
{
  "prediction": "N2",
  "confidence": 0.65,
  "probabilities": {
    "Wake": 0.05,
    "N1": 0.15,
    "N2": 0.65,
    "N3": 0.10,
    "REM": 0.05
  },
  "processing_time_ms": 45
}
```

---

## üé® Dashboard

### Lancer le Dashboard localement

```bash
# Installer les d√©pendances
pip install -r dashboard/requirements.txt

# Lancer l'application
streamlit run dashboard/streamlit_app.py
```

Le dashboard sera accessible sur `http://localhost:8501`

### Fonctionnalit√©s du Dashboard

- üìä **Visualisation des signaux EEG** en temps r√©el
- üîÆ **Pr√©diction interactive** des stades de sommeil
- üìà **Graphiques de probabilit√©s** par classe
- üéØ **Modes de g√©n√©ration** : signal synth√©tique ou al√©atoire
- üì° **Connexion √† l'API** d√©ploy√©e sur Render

---

## ü§ñ Mod√®les

### Mod√®le en Production

**Random Forest Pipeline v2** (`rf_v2_pipeline.joblib`)
- **Taille :** 7 MB
- **Features :** 16 features extraites
  - **Temporelles (8)** : Mean, Std, Min, Max, Q1, Q3, Skewness, Kurtosis
  - **Fr√©quentielles (5)** : Puissance Delta, Theta, Alpha, Beta, Gamma
  - **Ratios (3)** : Ratios de puissance normalis√©s
- **Performance :**
  - Accuracy : 65%
  - F1-Score weighted : 0.64
  - Cohen's Kappa : 0.52
- **Architecture :** Pipeline Scikit-learn complet (extraction + scaling + classification)

> **Note :** Les performances sont acceptables pour une preuve de concept. Le focus du projet est sur l'infrastructure MLOps plut√¥t que l'optimisation du mod√®le. Une am√©lioration future n√©cessitera plus de donn√©es et l'expertise de professionnels de sant√©.

### Features extraites

#### Statistiques temporelles (8 features)
- Amplitude moyenne et √©cart-type
- Min, Max, Q1, Q3
- Skewness (asym√©trie) et Kurtosis (aplatissement)

#### Analyse spectrale (5 features)
- **Delta (0.5-4 Hz)** : Sommeil profond
- **Theta (4-8 Hz)** : Somnolence
- **Alpha (8-13 Hz)** : Relaxation
- **Beta (13-30 Hz)** : √âveil actif
- **Gamma (30-35 Hz)** : Cognition

#### Ratios de puissance (3 features)
- Ratios normalis√©s entre les bandes de fr√©quence

---

## üõ†Ô∏è Technologies

### Machine Learning
- **Scikit-learn** : Pipeline ML, Random Forest
- **NumPy / Pandas** : Manipulation de donn√©es
- **SciPy** : Traitement du signal (FFT, filtrage)

### API & Backend
- **FastAPI** : Framework API REST
- **Uvicorn** : Serveur ASGI
- **Pydantic** : Validation de donn√©es

### Frontend
- **Streamlit** : Dashboard interactif
- **Matplotlib** : Visualisations

### DevOps & MLOps
- **Docker** : Containerisation
- **Docker Compose** : Orchestration
- **Render** : D√©ploiement cloud
- **GitHub Actions** : CI/CD (√† venir)

### Data Science
- **Jupyter** : Notebooks d'exploration
- **imbalanced-learn (SMOTE)** : Gestion des classes d√©s√©quilibr√©es

---

## üìä Performances

| Mod√®le | Accuracy | F1-Score | Taille | Temps inf√©rence |
|--------|----------|----------|--------|-----------------|
| RF Baseline (signaux bruts) | 34% | 0.32 | 20 MB | ~50ms |
| RF v2 Pipeline (features) | 65% | 0.64 | 7 MB | ~30ms |

### Matrice de confusion (Test set)

```
         Pred: Wake  N1   N2   N3  REM
Actual:
Wake        28      21    4    3    1
N1          17      66   24    1    5
N2           3      11  113   35   11
N3           1       0   24  140    0
REM          0      14   21    0   11
```

> **Note :** Le mod√®le performe bien sur N2 et N3 (sommeil profond), mais moins bien sur Wake et REM. Cela est coh√©rent avec la litt√©rature scientifique o√π ces stades sont plus difficiles √† distinguer.

---

## üîÆ Perspectives

### Limitations actuelles
- Accuracy √† 65% (preuve de concept, objectif >90% pour usage clinique)
- Dataset limit√© (Sleep-EDF uniquement)
- Pas d'interface pour professionnels de sant√©
- Pas de certification m√©dicale

### √âvolutions futures

#### Court terme (1-3 mois)
- ‚úÖ Am√©lioration du mod√®le (CNN, Transformers)
- ‚úÖ Augmentation du dataset (collaboration m√©dicale)
- ‚úÖ Tests A/B sur plusieurs architectures
- ‚úÖ Export de rapports PDF

#### Moyen terme (3-6 mois)
- üî¨ **D√©tection d'apn√©es du sommeil**
  - Nouvelles features (SpO2, d√©bit respiratoire)
  - Collaboration avec pneumologues
  - Validation clinique
- üìä Interface professionnelle pour m√©decins
- üîê Authentification et gestion des patients
- üìà Monitoring et d√©tection de drift

#### Long terme (6-12 mois)
- üè• **Certification dispositif m√©dical** (marquage CE)
- üîí H√©bergement de donn√©es de sant√© (HDS)
- üåç Conformit√© RGPD
- üì± Application mobile pour patients
- üîó Int√©gration FHIR (interop√©rabilit√©)

### Vision

Cr√©er une solution **open-source** et **accessible** pour aider les m√©decins de ville √† r√©duire le temps d'analyse des polysomnographies de **4h √† 30 minutes**, tout en maintenant une qualit√© diagnostique √©lev√©e.

---

## üìà Roadmap MLOps

- [x] Pipeline ML complet et s√©rialis√©
- [x] API REST FastAPI avec documentation
- [x] Dockerization compl√®te
- [x] D√©ploiement sur Render
- [x] Dashboard Streamlit interactif
- [ ] CI/CD avec GitHub Actions
- [ ] Tests unitaires et d'int√©gration
- [ ] Monitoring et logging avanc√©
- [ ] Versioning des mod√®les (DVC ou MLflow)

---

## üë• Auteur

**Marine Deldicque**
- GitHub : [@marinedde](https://github.com/marinedde)
- Projet : Jedha Bootcamp - MLOps
- Date : Octobre 2025

---

## üìÑ License

Ce projet est sous licence MIT. Voir le fichier `LICENSE` pour plus de d√©tails.

---

## üôè Remerciements

- **Jedha Bootcamp** pour le programme de formation MLOps
- **Sleep-EDF Database** pour les donn√©es d'entra√Ænement (Physionet)
- Communaut√©s **FastAPI**, **Scikit-learn** et **Streamlit**
- **Raphael** (mentor) pour les conseils strat√©giques

---

## üìû Contact

Pour toute question, suggestion ou collaboration :
- üìß Ouvrir une **issue** sur GitHub
- üí¨ Contacter via le profil GitHub

---

## üîó Liens utiles

- [API Documentation (Swagger)](https://sleepai-api.onrender.com/docs)
- [GitHub Repository](https://github.com/marinedde/sleepai)
- [Dataset Sleep-EDF](https://physionet.org/content/sleep-edfx/1.0.0/)
- [FastAPI Documentation](https://fastapi.tiangolo.com/)
- [Streamlit Documentation](https://docs.streamlit.io/)

---

<div align="center">

**‚≠ê Si ce projet vous pla√Æt, n'h√©sitez pas √† le star sur GitHub ! ‚≠ê**

Made with ‚ù§Ô∏è and ‚òï by Marine Deldicque

</div>